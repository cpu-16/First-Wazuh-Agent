# Integración con n8n

## 7) Integración con n8n

**Recomendación práctica:**

- 1 nodo HTTP para Indexer (9200) (Basic Auth)
- 1 nodo HTTP para API 55000 (JWT + Bearer)

**No conviene mezclar todo en un solo nodo porque:**
- cambian endpoints
- cambia el tipo de auth
- cambia la semántica (alertas vs agentes)

### 7.1 Nodo HTTP (Indexer 9200) — Body ejemplo (últimas 2h)

**Configuración:**

- **Method:** POST
- **URL:** `https://100.109.242.43:9200/wazuh-alerts-4.x-*/_search`
- **Auth:** Basic (`admin` + pass)
- **Header:** `Content-Type: application/json`

**Body:**

```json
{
  "size": 10,
  "sort": [{ "@timestamp": { "order": "desc" } }],
  "_source": ["@timestamp","agent.id","agent.name","rule.id","rule.level","rule.description"],
  "query": { "range": { "@timestamp": { "gte": "now-2h", "lt": "now" } } }
}
```

![Nodo HTTP Indexer en n8n](images/n8n-indexer.png)

### 7.2 Nodo HTTP (API 55000) — flujo JWT

#### Nodo A: Authenticate (token)

- **Method:** POST
- **URL:** `https://100.109.242.43:55000/security/user/authenticate?raw=true`
- **Auth:** Basic Auth (`wazuh` + pass)
- **Respuesta:** texto (JWT raw)

#### Nodo B: List agents (Bearer)

- **Method:** GET
- **URL:** `https://100.109.242.43:55000/agents?limit=200&select=id,name,status,lastKeepAlive,version,ip`
- **Header:**

```
Authorization: Bearer {{$json}}
```

> Si el nodo anterior devuelve el token como texto directo. Si el token viene dentro de JSON, ajusta a: `Bearer {{$json.data}}` o el campo exacto que estés recibiendo.

![Flujo JWT en n8n](images/n8n-jwt-flow.png)

---

[← Volver al README principal](../README.md)
